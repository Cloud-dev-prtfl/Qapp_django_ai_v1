{% extends "base.html" %}
{% load static %}

{% block title %}Profile | AI Project{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}?v=2.0">
    <style>
        .profile-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
{% endblock %}

{% block content %}
<div class="profile-header">
    <h1>Account Settings</h1>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="profile-section" id="section-update-profile">
    <div class="section-header">
        <h2>Update Profile</h2>
        <p></p>
    </div>
    
    <div class="profile-card">
        <div class="profile-banner">
            <div class="banner-avatar">
                {{ user.username|make_list|first|upper }}
            </div>
            <div class="banner-info">
                <h3>{{ user.first_name }} {{ user.last_name }}</h3>
                <span>{% if user.is_superuser %}Administrator{% else %}Member{% endif %}</span>
            </div>
        </div>

        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="{{ form.username.id_for_label }}">Username *</label>
                        {{ form.username }}
                        {% if form.username.errors %}
                            <ul class="error-list">{% for error in form.username.errors %}<li>{{ error }}</li>{% endfor %}</ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}">Email Address *</label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <ul class="error-list">{% for error in form.email.errors %}<li>{{ error }}</li>{% endfor %}</ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}">First Name</label>
                        {{ form.first_name }}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}">Last Name</label>
                        {{ form.last_name }}
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="profile-section" id="section-reset-password">
    <div class="section-header">
        <h2>Reset Password</h2>
        <p></p>
    </div>

    <div class="profile-card">
        <div class="card-body">
            <div class="form-group">
                <label>Email Address</label>
                <input type="text" value="{{ user.email }}" disabled class="form-input disabled-input">
                <span class="help-text">We will send the reset link to this email address.</span>
            </div>

            <div class="form-actions">
                <a href="{% url 'trigger_password_reset' %}" class="submit-btn">
                    Send Link
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        function showSection() {
            document.querySelectorAll('.profile-section').forEach(el => el.style.display = 'none');
            const hash = window.location.hash;
            if (hash === '#reset-password') {
                document.getElementById('section-reset-password').style.display = 'block';
            } else {
                document.getElementById('section-update-profile').style.display = 'block';
            }
        }
        showSection();
        window.addEventListener('hashchange', showSection);
    });
</script>
{% endblock %}  